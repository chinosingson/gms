(function(){var originalOnAdd=L.Marker.prototype.onAdd;L.Marker.mergeOptions({bounceOnAdd:false,bounceOnAddDuration:1000,bounceOnAddHeight:-1});L.Marker.include({_toPoint:function(latlng){return this._map.latLngToContainerPoint(latlng)},_toLatLng:function(point){return this._map.containerPointToLatLng(point)},_animate:function(opts){var start=new Date();var id=setInterval(function(){var timePassed=new Date()-start;var progress=timePassed/opts.duration;if(progress>1){progress=1}var delta=opts.delta(progress);opts.step(delta);if(progress===1){opts.end();clearInterval(id)}},opts.delay||10)},_move:function(delta,duration){var original=L.latLng(this._orig_latlng),start_y=this._drop_point.y,start_x=this._drop_point.x,distance=this._point.y-start_y;var self=this;this._animate({delay:10,duration:duration||1000,delta:delta,step:function(delta){self._drop_point.y=start_y+(distance*delta)-(self._map.project(self._map.getCenter()).y-self._orig_map_center.y);self._drop_point.x=start_x-(self._map.project(self._map.getCenter()).x-self._orig_map_center.x);self.setLatLng(self._toLatLng(self._drop_point))},end:function(){self.setLatLng(original)}})},_easeOutBounce:function(pos){if((pos)<(1/2.75)){return(7.5625*pos*pos)}else if(pos<(2/2.75)){return(7.5625*(pos-=(1.5/ 2.75)) * pos + 0.75)} else if (pos < (2.5 /2.75)){return(7.5625*(pos-=(2.25/2.75))*pos+0.9375)}else{return(7.5625*(pos-=(2.625/2.75))*pos+0.984375)}},bounce:function(duration,height){this._orig_map_center=this._map.project(this._map.getCenter());this._drop_point=this._getDropPoint(height);this._move(this._easeOutBounce,duration)},_getDropPoint:function(height){this._point=this._toPoint(this._orig_latlng);var top_y;if(height===undefined||height<0){top_y=this._toPoint(this._map.getBounds()._northEast).y}else{top_y=this._point.y-height}return new L.Point(this._point.x,top_y)},onAdd:function(map){this._map=map;this._orig_latlng=this._latlng;if(this.options.bounceOnAdd===true){this._drop_point=this._getDropPoint(this.options.bounceOnAddHeight);this.setLatLng(this._toLatLng(this._drop_point))}originalOnAdd.call(this,map);if(this.options.bounceOnAdd===true){this.bounce(this.options.bounceOnAddDuration,this.options.bounceOnAddHeight)}}})})();